# 简化架构说明（移除 NGINX）

## 📋 架构变更

### 🔴 **移除前**（Docker 微服务架构）
```
用户 → NGINX (8018) → FastAPI (8028) → Celery Worker → Redis
```

### 🟢 **移除后**（简化架构）
```
用户 → FastAPI (8018) → Celery Worker → Redis
```

## 🔧 变更内容

1. **移除 NGINX 服务**
   - 不再需要 NGINX 反向代理
   - 不再需要前端静态文件服务（由 FastAPI 直接提供）

2. **API 服务器直接暴露端口**
   - 端口：`8018`（直接对外暴露）
   - 用户直接访问：`http://localhost:8018`

3. **保留的服务**
   - ✅ Redis（消息队列）
   - ✅ Celery Worker（异步任务，可选）
   - ✅ FastAPI 服务器（直接提供前端和 API）

## 🚀 启动方式

### 方式 1：使用 Docker Compose（推荐）

```bash
# 启动服务（不包含 NGINX）
sudo docker compose up -d

# 查看服务状态
sudo docker compose ps

# 查看日志
sudo docker compose logs -f api-server
```

### 方式 2：直接运行 server.py（最简单）

```bash
# 不需要 Docker，直接运行
python server.py
# 或
uvicorn server:app --host 0.0.0.0 --port 8018
```

## 📝 访问地址

- **Web 界面**：`http://localhost:8018`
- **API 文档**：`http://localhost:8018/api/docs`
- **测试页面**：`http://localhost:8018`（server.py 内嵌的测试界面）

## ✅ 优势

1. **简化架构**：减少一个服务，降低复杂度
2. **易于调试**：直接访问 API 服务器，问题更容易定位
3. **开发友好**：可以直接运行 `python server.py`，无需 Docker
4. **前端集成**：前端由同事集成，后端只需提供 API

## 📋 注意事项

1. **前端文件**：
   - `server.py` 内嵌了简单的测试界面（左右分栏）
   - 如果需要使用根目录的 `index.html`，需要修改 `server.py` 的 `index()` 函数

2. **生产环境**：
   - 当前架构适合开发和测试
   - 生产环境建议使用 NGINX 作为反向代理（但当前不需要）

3. **端口冲突**：
   - 如果 8018 端口被占用，可以修改 `docker-compose.yml` 中的端口映射

## 🔄 如果需要恢复 NGINX

如果将来需要恢复 NGINX，可以：
1. 恢复 `docker-compose.yml` 中的 NGINX 服务配置
2. 恢复 `services/nginx/conf.d/default.conf`
3. 将 API 服务器端口改回内部端口（如 8028）

