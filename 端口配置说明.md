# 端口配置说明

## 📋 当前端口配置

| 服务 | 容器内部端口 | 对外暴露端口 | 说明 |
|------|------------|------------|------|
| NGINX | 80 | **8018** | 用户访问入口 |
| FastAPI API | **8028** | - | 仅容器内部访问（已从8000改为8028） |
| Redis | 6379 | - | 仅容器内部访问 |
| Celery | - | - | 无端口（通过 Redis 通信） |

## 🔧 已修改的文件

1. **docker-compose.yml**
   - Gunicorn 绑定端口：`--bind 0.0.0.0:8028`

2. **services/nginx/conf.d/default.conf**
   - Upstream 地址：`server api-server:8028;`

3. **services/api/Dockerfile**
   - EXPOSE 端口：`EXPOSE 8028`

## 🚀 重新启动服务

修改端口后，需要重新启动服务：

```bash
# 1. 停止所有容器
sudo docker compose down

# 2. 重新启动（不需要重新构建，因为只是端口配置改变）
sudo docker compose up -d

# 3. 验证端口
sudo docker compose ps
sudo docker compose logs api-server | grep "8028"
```

## ✅ 验证修复

```bash
# 1. 检查容器状态
sudo docker compose ps
# 所有容器应该是 "Up" 状态

# 2. 测试 API 服务器内部端口
sudo docker compose exec api-server curl -s http://localhost:8028/api/docs | head -5

# 3. 测试通过 NGINX 访问
curl -s http://localhost:8018/api/docs | head -5

# 4. 访问前端
# 浏览器打开：http://localhost:8018
```

## 📝 注意事项

- **8028 端口**：仅在 Docker 容器内部使用，不对外暴露
- **8018 端口**：用户访问的唯一入口（通过 NGINX）
- 如果 8028 端口也被占用，可以改为其他端口（如 8029、8030 等）

